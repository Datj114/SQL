CREATE DATABASE QLNV
USE  QLNV
CREATE TABLE NHANVIEN(
	MANV CHAR(20) NOT NULL PRIMARY KEY,
	TENVN CHAR(20) ,
	NGAYSINH DATE,
	TRINHDO CHAR(20),
	CHUCVU CHAR(20))

	CREATE TABLE KHOAHOC(
	MAKH CHAR(20) NOT NULL PRIMARY KEY,
	TENKH CHAR(20),
	DIADIEM CHAR(20))

	CREATE TABLE THAMGIA(
	MANV CHAR(20) NOT NULL,
	MAKH CHAR(20) NOT NULL,
	SOBUOINGHI INT,
	KETQUA CHAR(20),
	CONSTRAINT PK_NV PRIMARY KEY (MANV,MAKH),
	CONSTRAINT FK_NV FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV) ON UPDATE CASCADE ON DELETE CASCADE,
	CONSTRAINT FK_KH FOREIGN KEY (MAKH) REFERENCES KHOAHOC(MAKH) ON UPDATE CASCADE ON DELETE CASCADE)

	INSERT INTO NHANVIEN VALUES
	(N'NV04',N'Trần Văn DOAN',	'12-5-1989',N'Đại học',N'Nhân viên'),
	(N'NV01',N'Trần Văn Ước',	'12-5-1988',N'Đại học',N'Nhân viên'),
	(N'NV02',N'Hoàng Văn Huy',	'12-17-2000',	N'Đại học'	,N'Trưởng phòng'),
	(N'NV03','Nguyễn Thị Chính','	2-5-1982','	Cao Đẳng',N'	Nhân viên')

	INSERT INTO KHOAHOC VALUES
	(N'KH01','	Giao tiếp cơ bản','Hà Nội'),
	(N'KH02','	Giao tiếp nâng cao','Hà Nội'),
	(N'KH03','	Phân tích số liệu','	Hồ Chí Minh')

	INSERT INTO THAMGIA VALUES
	(N'NV01',N'KH01',1,'KHA'),
	(N'NV01',N'KH02',2,'KHA'),
	(N'NV02',N'KH01',0,'GIOI'),
	(N'NV02',N'KH02',1,'KHA'),
	(N'NV02',N'KH03',1,'TRUNG BINH'),
	(N'NV03',N'KH01',4,'TRUNG BINH')

	SELECT * FROM NHANVIEN
	SELECT * FROM KHOAHOC
	SELECT * FROM THAMGIA

	SELECT TENVN FROM NHANVIEN WHERE TRINHDO = 'Đại học'

	SELECT TENVN FROM NHANVIEN WHERE TENVN LIKE 'Trần%' AND YEAR(NGAYSINH)=2000

	SELECT TENVN FROM NHANVIEN 
	JOIN THAMGIA ON NHANVIEN.MANV=THAMGIA.MANV
	WHERE MAKH = N'KH02' AND KETQUA='KHA'

	SELECT NHANVIEN.MANV, TENVN, NGAYSINH FROM NHANVIEN
	JOIN THAMGIA ON NHANVIEN.MANV=THAMGIA.MANV
	JOIN KHOAHOC ON KHOAHOC.MAKH=THAMGIA.MAKH
	WHERE DIADIEM='Hà Nội' AND SOBUOINGHI>2

	SELECT NHANVIEN.MANV, TENVN, SOBUOINGHI, KETQUA FROM NHANVIEN
	JOIN THAMGIA ON NHANVIEN.MANV=THAMGIA.MANV
	JOIN KHOAHOC ON KHOAHOC.MAKH=THAMGIA.MAKH
	WHERE TENKH LIKE '%Giao tiếp% '

	--F
	SELECT KHOAHOC.MAKH,TENKH,COUNT(MANV) FROM KHOAHOC
	JOIN THAMGIA ON KHOAHOC.MAKH=THAMGIA.MAKH
	WHERE KETQUA='GIOI'
	GROUP BY KHOAHOC.MAKH,TENKH

	--G
	SELECT NHANVIEN.MANV, COUNT(MAKH) FROM NHANVIEN
	JOIN THAMGIA ON NHANVIEN.MANV=THAMGIA.MANV
	GROUP BY NHANVIEN.MANV

	--H
	SELECT KHOAHOC.MAKH,TENKH FROM KHOAHOC
	JOIN THAMGIA ON THAMGIA.MAKH=KHOAHOC.MAKH
	GROUP BY KHOAHOC.MAKH,TENKH
	HAVING COUNT(MANV)>=2

	--I
	SELECT NHANVIEN.MANV, TENVN, TRINHDO FROM NHANVIEN
	JOIN THAMGIA ON NHANVIEN.MANV=THAMGIA.MANV
	WHERE NGAYSINH =(SELECT MIN(NGAYSINH) FROM NHANVIEN) AND MAKH='KH03'

	--J
	SELECT NHANVIEN.MANV,TENVN FROM NHANVIEN
	JOIN THAMGIA ON THAMGIA.MANV= NHANVIEN.MANV
	GROUP BY NHANVIEN.MANV,TENVN
	HAVING COUNT(MAKH)= (SELECT COUNT(MAKH) FROM KHOAHOC)

	--K
	SELECT NHANVIEN.MANV,TENVN FROM NHANVIEN
	WHERE NHANVIEN.MANV NOT IN (SELECT MANV FROM THAMGIA)

	--L
	SELECT MANV, COUNT(MAKH) AS SoLuongKhoaHoc
FROM THAMGIA
GROUP BY MANV
HAVING COUNT(MAKH) = (
    SELECT MAX(SoLuongKhoaHoc)
    FROM (SELECT MANV, COUNT(MAKH) AS SoLuongKhoaHoc
          FROM THAMGIA
          GROUP BY MANV) AS ThongKeKhoaHoc
);
