CREATE DATABASE QLNV
USE  QLNV
CREATE TABLE NHANVIEN(
	MANV CHAR(20) NOT NULL PRIMARY KEY,
	TENVN CHAR(20) ,
	NGAYSINH DATE,
	TRINHDO CHAR(20),
	CHUCVU CHAR(20))

	CREATE TABLE KHOAHOC(
	MAKH CHAR(20) NOT NULL PRIMARY KEY,
	TENKH CHAR(20),
	DIADIEM CHAR(20))

	CREATE TABLE THAMGIA(
	MANV CHAR(20) NOT NULL,
	MAKH CHAR(20) NOT NULL,
	SOBUOINGHI INT,
	KETQUA CHAR(20),
	CONSTRAINT PK_NV PRIMARY KEY (MANV,MAKH),
	CONSTRAINT FK_NV FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV) ON UPDATE CASCADE ON DELETE CASCADE,
	CONSTRAINT FK_KH FOREIGN KEY (MAKH) REFERENCES KHOAHOC(MAKH) ON UPDATE CASCADE ON DELETE CASCADE)

	INSERT INTO NHANVIEN VALUES
	(N'NV04',N'Trần Văn DOAN',	'12-5-1989',N'Đại học',N'Nhân viên'),
	(N'NV01',N'Trần Văn Ước',	'12-5-1988',N'Đại học',N'Nhân viên'),
	(N'NV02',N'Hoàng Văn Huy',	'12-17-2000',	N'Đại học'	,N'Trưởng phòng'),
	(N'NV03','Nguyễn Thị Chính','	2-5-1982','	Cao Đẳng',N'	Nhân viên')

	INSERT INTO KHOAHOC VALUES
	(N'KH01','	Giao tiếp cơ bản','Hà Nội'),
	(N'KH02','	Giao tiếp nâng cao','Hà Nội'),
	(N'KH03','	Phân tích số liệu','	Hồ Chí Minh')
	INSERT INTO THAMGIA VALUES
	(N'NV04',N'KH01',1,N'kém')
	INSERT INTO THAMGIA VALUES
	(N'NV01',N'KH03',5,'KHA')
	INSERT INTO THAMGIA VALUES
	(N'NV01',N'KH01',1,'KHA'),
	(N'NV01',N'KH02',2,'KHA'),
	(N'NV02',N'KH01',0,'GIOI'),
	(N'NV02',N'KH02',1,'KHA'),
	(N'NV02',N'KH03',1,'TRUNG BINH'),
	(N'NV03',N'KH01',4,'TRUNG BINH')

	SELECT * FROM NHANVIEN
	SELECT * FROM KHOAHOC
	SELECT * FROM THAMGIA

	SELECT TENVN FROM NHANVIEN WHERE TRINHDO = 'Đại học'

	SELECT TENVN FROM NHANVIEN WHERE TENVN LIKE 'Trần%' AND YEAR(NGAYSINH)=2000

	SELECT TENVN FROM NHANVIEN 
	JOIN THAMGIA ON NHANVIEN.MANV=THAMGIA.MANV
	WHERE MAKH = N'KH02' AND KETQUA='KHA'

	SELECT NHANVIEN.MANV, TENVN, NGAYSINH FROM NHANVIEN
	JOIN THAMGIA ON NHANVIEN.MANV=THAMGIA.MANV
	JOIN KHOAHOC ON KHOAHOC.MAKH=THAMGIA.MAKH
	WHERE DIADIEM='Hà Nội' AND SOBUOINGHI>2

	SELECT NHANVIEN.MANV, TENVN, SOBUOINGHI, KETQUA FROM NHANVIEN
	JOIN THAMGIA ON NHANVIEN.MANV=THAMGIA.MANV
	JOIN KHOAHOC ON KHOAHOC.MAKH=THAMGIA.MAKH
	WHERE TENKH LIKE '%Giao tiếp% '

	--F
	SELECT KHOAHOC.MAKH,TENKH,COUNT(MANV) FROM KHOAHOC
	JOIN THAMGIA ON KHOAHOC.MAKH=THAMGIA.MAKH
	WHERE KETQUA='GIOI'
	GROUP BY KHOAHOC.MAKH,TENKH

	--Gg.	Lấy ra mã nhân viên và số khóa học nhân viên đó đã tham gia.
	SELECT MANV, COUNT(MAKH) FROM THAMGIA
	GROUP BY MANV

	SELECT NHANVIEN.MANV, COUNT(MAKH) FROM NHANVIEN
	JOIN THAMGIA ON NHANVIEN.MANV=THAMGIA.MANV
	GROUP BY NHANVIEN.MANV

	--Hh.	Lấy ra mã và tên các khóa học có từ 2 nhân viên trở lên tham gia học.
	SELECT KHOAHOC.MAKH, TENKH FROM KHOAHOC
	JOIN THAMGIA ON KHOAHOC.MAKH=THAMGIA.MAKH
	GROUP BY KHOAHOC.MAKH, TENKH
	HAVING COUNT(KHOAHOC.MAKH)>=2

	--Ii.	Đưa ra thông tin nhiều tuổi nhất khóa học ‘Phân tích số liệu’
	SELECT NHANVIEN.MANV, TENVN, TRINHDO FROM NHANVIEN
	JOIN THAMGIA ON NHANVIEN.MANV=THAMGIA.MANV
	WHERE NGAYSINH =(SELECT MIN(NGAYSINH) FROM NHANVIEN) AND MAKH='KH03'

	--Jj.	Lấy ra mã và tên nhân viên đã tham gia tất cả các khóa học.
	SELECT NHANVIEN.MANV,TENVN FROM NHANVIEN
	JOIN THAMGIA ON THAMGIA.MANV= NHANVIEN.MANV
	GROUP BY NHANVIEN.MANV,TENVN
	HAVING COUNT(MAKH)= (SELECT COUNT(MAKH) FROM KHOAHOC)

	--Kk.	Đưa ra nhân viên không tham gia khóa học nào
	SELECT NHANVIEN.MANV,TENVN FROM NHANVIEN
	WHERE NHANVIEN.MANV NOT IN (SELECT MANV FROM THAMGIA)

	--Ll.	Đưa ra nhân viên tham gia nhiều khóa học nhất
	SELECT MANV
	FROM THAMGIA
	GROUP BY MANV
	HAVING COUNT(MAKH) = (SELECT MAX(SoLuongKhoaHoc)
    FROM (SELECT MANV, COUNT(MAKH) AS SoLuongKhoaHoc
          FROM THAMGIA
          GROUP BY MANV) AS ThongKeKhoaHoc)
	
	--m.	Đưa ra khóa học không có học viên nào học lực ‘Kém’
	select * FROM THAMGIA
	SELECT DISTINCT MAKH FROM THAMGIA
	WHERE MAKH NOT IN (SELECT MAKH FROM THAMGIA WHERE KETQUA =N'kém')
	--n.	Đưa ra nhân viên có số buổi nghỉ học nhiều nhất
	SELECT MANV FROM THAMGIA
	GROUP BY MANV
	HAVING SUM(SOBUOINGHI) =(SELECT MAX(BUOI) FROM (SELECT MANV, SUM(SOBUOINGHI) AS BUOI FROM THAMGIA
	GROUP BY MANV) AS BANGNGHI)